<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sidds Dev - Marauder Command Center (Stable)</title>
  <style>
    /* --- SIDDS DEV THEME v3 --- */
    body {
      font-family: 'Courier New', Courier, monospace;
      background-color: #0d0d0d;
      color: #00ff41;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      box-sizing: border-box;
    }

    h1 {
      border-bottom: 2px solid #00ff41;
      padding-bottom: 10px;
      margin-top: 0;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    /* --- LAYOUT --- */
    .main-container {
      display: flex;
      width: 100%;
      height: 100%;
      gap: 20px;
      overflow: hidden; /* Prevents body scroll */
    }

    /* --- TERMINAL (LEFT) --- */
    .terminal-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    #terminal {
      flex-grow: 1;
      background-color: #000;
      border: 1px solid #333;
      padding: 10px;
      font-size: 13px;
      overflow-y: auto;
      white-space: pre-wrap;
      color: #00ff41;
      margin-bottom: 10px;
      box-shadow: inset 0 0 10px rgba(0,255,65,0.1);
    }

    .input-group {
      display: flex;
      gap: 10px;
    }

    input[type="text"] {
      flex-grow: 1;
      background: #1a1a1a;
      border: 1px solid #333;
      color: white;
      padding: 10px;
    }

    /* --- CONTROLS (RIGHT) --- */
    .controls-wrapper {
      width: 300px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
    }

    .section-title {
      font-weight: bold;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
      margin-top: 10px;
      color: #fff;
    }

    button {
      background: #1a1a1a;
      color: #00ff41;
      border: 1px solid #333;
      padding: 12px;
      cursor: pointer;
      text-align: left;
      transition: 0.2s;
      font-family: 'Courier New', Courier, monospace;
      font-weight: bold;
    }

    button:hover {
      background: #00ff41;
      color: #000;
    }

    button:active { transform: translateY(2px); }

    .btn-red { border-color: #ff3333; color: #ff3333; }
    .btn-red:hover { background: #ff3333; color: #fff; }
    
    .btn-connect { background: #333; color: white; text-align: center; font-size: 1.1em; margin-bottom: 10px; }

  </style>
</head>
<body>

  <h1>Sidds Dev Tool</h1>

  <div class="main-container">
    
    <div class="terminal-wrapper">
      <div id="terminal">Waiting for connectio   . . . . . n...</div>
      <div class="input-group">
        <input type="text" id="customCmd" placeholder="Type command here (e.g. reboot)">
        <button onclick="sendManual()">SEND</button>
      </div>
    </div>

    <div class="controls-wrapper">
      <button onclick="connectSerial()" class="btn-connect" id="connectBtn">âš¡ CONNECT</button>

      <div class="section-title">WIFI ATTACKS</div>
      <button onclick="send('scanap')">1. Scan APs</button>
      <button onclick="send('stopscan')">2. Stop Scan</button>
      <button onclick="send('select -a')">3. Select ALL</button>
      <button onclick="send('attack -t beacon')">4. Beacon Spam</button>
      <button onclick="send('attack -t deauth')">5. Deauth Flood</button>
      <button onclick="send('stopattack')" class="btn-red">ðŸ›‘ STOP WIFI</button>

      <div class="section-title">BLUETOOTH</div>
      <button onclick="send('ble_scan')">6. Scan BLE</button>
      <button onclick="send('ble_tx sour apple')">7. iOS Crash</button>
      <button onclick="send('ble_tx samsung')">8. Samsung Spam</button>
      <button onclick="send('stopattack')" class="btn-red">ðŸ›‘ STOP BLE</button>

      <div class="section-title">SYSTEM</div>
      <button onclick="send('reboot')">Reboot</button>
      <button onclick="send('help')">Help Menu</button>
      <button onclick="send('clearlist -a')">Clear Lists</button>
    </div>
  </div>

  <script>
    let port;
    let writer;
    let keepReading = false;
    let incomingBuffer = ""; // The buffer to stop the freezing

    const terminal = document.getElementById('terminal');
    const connectBtn = document.getElementById('connectBtn');

    // --- CONNECT ---
    async function connectSerial() {
      if (!navigator.serial) {
        alert("Use Chrome or Edge.");
        return;
      }

      try {
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });

        connectBtn.textContent = "CONNECTED";
        connectBtn.style.color = "#00ff41";
        keepReading = true;
        
        readLoop();
        updateTerminalLoop(); // Start the UI updater
        
        // Auto-send help to check life
        setTimeout(() => send('help'), 1000); 

      } catch (err) {
        alert("Connection Failed: " + err);
      }
    }

    // --- SEND COMMAND ---
    async function send(cmd) {
      if (!port || !port.writable) return;
      
      // Append to terminal locally so you see what you typed
      incomingBuffer += `\n> ${cmd}\n`;

      const encoder = new TextEncoder();
      const writer = port.writable.getWriter();
      // Marauder needs \r\n to execute
      await writer.write(encoder.encode(cmd + "\r\n"));
      writer.releaseLock();
    }

    function sendManual() {
      const input = document.getElementById('customCmd');
      if (input.value) {
        send(input.value);
        input.value = "";
      }
    }

    // --- READER LOOP (High Speed) ---
    async function readLoop() {
      const decoder = new TextDecoder();
      
      while (port.readable && keepReading) {
        const reader = port.readable.getReader();
        try {
          while (true) {
            const { value, done } = await reader.read();
            if (done) break;
            if (value) {
              // DO NOT UPDATE DOM HERE. Just add to buffer.
              incomingBuffer += decoder.decode(value);
            }
          }
        } catch (error) {
          console.error(error);
        } finally {
          reader.releaseLock();
        }
      }
    }

    // --- UI UPDATER (Low Speed - Prevents Freeze) ---
    function updateTerminalLoop() {
      if (incomingBuffer.length > 0) {
        // Limit buffer size to prevent memory crash
        if (terminal.textContent.length > 50000) terminal.textContent = "--- LOG CLEARED ---\n";

        terminal.textContent += incomingBuffer;
        terminal.scrollTop = terminal.scrollHeight; // Auto scroll
        incomingBuffer = ""; // Clear buffer
      }
      // Run this 30 times a second, not 1000 times a second
      requestAnimationFrame(updateTerminalLoop);
    }
  </script>
</body>
</html>
